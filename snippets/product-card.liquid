<div class="studio-product-card product-card-{{ product.id }} {% unless product.available %}product-card--sold-out{% endunless %}" style="position: relative;">
  
  {% comment %} 1. IMAGE AREA {% endcomment %}
  <div class="image-frame" style="position: relative; overflow: hidden; z-index: 1;">
    <a href="{{ product.url }}" style="display: block;">
      <span class="sold-out-badge" {% if product.available %}style="display:none"{% endif %} 
            style="position: absolute; top: 10px; left: 10px; background: #800000; color: #fff; padding: 5px 10px; font-size: 10px; z-index: 2;">
        SOLD OUT
      </span>

      <img 
        src="{{ product.featured_image | image_url: width: 400 }}" 
        alt="{{ product.featured_image.alt | escape }}"
        loading="lazy"
        width="400"
        height="400"
        class="grid-img main-card-img"
      >
    </a>

    {% comment %} QUICK ADD FORM {% endcomment %}
    {% form 'product', product, class: 'product-card-form' %}
      <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" class="selected-variant-id">
      <input type="hidden" name="quantity" value="1">
      
      <button type="submit" name="add" class="quick-add-btn {% unless product.available %}disabled{% endunless %}" 
              {% unless product.available %}disabled{% endunless %}>
        {% if product.available %}ADD TO BAG{% else %}UNAVAILABLE{% endif %}
      </button>
    {% endform %}
  </div>

  {% comment %} 2. INFO AREA {% endcomment %}
  <div class="product-info" style="padding: 10px 0; position: relative; z-index: 10;">
    <p class="brand-name">{{ product.vendor }}</p>
    <h3 class="product-title" style="margin: 5px 0;">
      <a href="{{ product.url }}" style="text-decoration: none; color: inherit;">{{ product.title }}</a>
    </h3>
    
    <p class="product-price">
      {{ product.price | money }}
    </p>

    {% comment %} === DROPDOWN VARIANT SELECTOR === {% endcomment %}
   {% if product.variants.size > 1 %}
  <details class="grid-variant-disclosure" style="position: relative; margin-top: 10px;">
    <summary style="list-style: none; padding: 8px; font-size: 11px; border: 1px solid #800000; background: #fff; display: flex; justify-content: space-between; align-items: center; cursor: pointer; text-transform: uppercase;">
      <span id="label-{{ product.id }}" class="current-variant-name">Select Option</span>
      <span>â–¼</span>
    </summary>

    <div class="grid-variant-dropdown" style="position: absolute; top: 100%; left: 0; width: 100%; background: #fff; border: 1px solid #800000; border-top: none; z-index: 1000; box-shadow: 0 5px 10px #800000;">
      <ul style="list-style: none; padding: 0; margin: 0; max-height: 150px; overflow-y: auto;">
        {% for variant in product.variants %}
          <li style="border-bottom: 1px solid #eee;">
            <button type="button" 
                    class="grid-variant-option" 
                    data-variant-id="{{ variant.id }}" 
                    data-variant-price="{{ variant.price | money }}"
                    data-parent-label="label-{{ product.id }}"
                    data-title="{{ variant.title }}"
                    style="width: 100%; border: none; background: none; padding: 10px; cursor: pointer; display: flex; justify-content: space-between; font-size: 11px; text-align: left;">
              <span>{{ variant.title }}</span>
              <span style="color: #666;">{{ variant.price | money }}</span>
            </button>
          </li>
        {% endfor %}
      </ul>
    </div>
  </details>
{% endif %}
  </div>
</div>

<style>
  .product-card-form {
    position: absolute;
    bottom: -60px;
    left: 0;
    width: 100%;
    transition: bottom 0.3s ease;
    z-index: 5;
  }
  .studio-product-card:hover .product-card-form {
    bottom: 0;
  }
  .quick-add-btn {
    width: 100%;
    background: #800000;
    color: #fff;
    border: none;
    padding: 12px;
    font-size: 11px;
    cursor: pointer;
    font-weight: bold;
  }
  /* Ensure the dropdown list items don't trigger the product link */
  .grid-variant-option {
    position: relative;
    z-index: 1000;
  }
  .grid-variant-option:hover {
    background: #f4f4f4;
  }
</style>
